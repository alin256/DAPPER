<!-- Search file for "CHANGE" for my own changes -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>dev_guide API documentation</title>
<meta name="description" content="Developer guide â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<link rel="preconnect" href="https://www.google.com">
<script async src="https://cse.google.com/cse.js?cx=017837193012385208679:pey8ky8gdqw"></script>
<style>
.gsc-control-cse {padding:0 !important;margin-top:1em}
body.gsc-overflow-hidden #sidebar {overflow: visible;}
</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<link rel="icon" href="https://raw.githubusercontent.com/nansencenter/DAPPER/master/docs/imgs/logo.png">
<!-- Dont work coz pdoc already defines these:
<title>DAPPER doc</title>
<meta name="description" content="Data Assimilation with Python: a Package for Experimental Research" />
-->
<a href="https://github.com/nansencenter/DAPPER" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>dev_guide</code></h1>
</header>
<section id="section-intro">
<h1 id="developer-guide">Developer guide</h1>
<h2 id="conventions">Conventions</h2>
<ul>
<li>Ensemble (data) matrices are <code>np.ndarrays</code> with shape <code>N-by-Nx</code>.
This shape (orientation) is contrary to the EnKF literature,
but has the following advantages:<ul>
<li>Improves speed in row-by-row accessing,
since that's <code>np</code>'s default orientation.</li>
<li>Facilitates broadcasting for, e.g. centring the matrix.</li>
<li>Fewer indices: <code>[n,:]</code> yields same as <code>[n]</code></li>
<li>Beneficial operator precedence without <code>()</code>.
E.g. <code>dy @ Rinv @ Y.T @ Pw</code> (where <code>dy</code> is a vector)</li>
<li>Less transposing for for ensemble space formulae.</li>
<li>It's the standard for data matrices in the broader statistical literature.</li>
</ul>
</li>
<li>Naming:<ul>
<li><code>E</code>: ensemble matrix</li>
<li><code>w</code>: ensemble weights or coefficients</li>
<li><code>X</code>: centred ensemble ("anomalies")</li>
<li><code>N</code>: ensemble size</li>
<li><code>Nx</code>: state size</li>
<li><code>Ny</code>: observation size</li>
<li><em>Double letters</em> means a sequence of something.
For example:<ul>
<li><code>xx</code>: Time series of truth; shape <code>(K+1, Nx)</code></li>
<li><code>yy</code>: Time series of observations; shape <code>(KObs+1, Nx)</code></li>
<li><code>EE</code>: Time series of ensemble matrices</li>
<li><code>ii</code>, <code>jj</code>: Sequences of indices (integers)</li>
</ul>
</li>
<li><code>xps</code>: an <code>xpList</code> or <code>xpDict</code>,
where <code>xp</code> abbreviates "experiment".</li>
</ul>
</li>
</ul>
<h2 id="install-for-development">Install for development</h2>
<p>Make sure you included the dev tools as part of the installation
(detailed in the README):</p>
<pre><code class="language-sh">pip install -e .[dev]
</code></pre>
<h2 id="run-tests">Run tests</h2>
<p>By default, only <code>doctests</code> are run when executing <code>pytest</code>.
To run the main tests, do this:</p>
<pre><code class="language-sh">pytest tests
</code></pre>
<p>You can also append <code>test_plotting.py</code> for example,
which is otherwise ignored for being slow.</p>
<p>If the test with the <code>QG</code> model in <code>test_HMM.py</code> fails
(simply because you have not compiled it) that is fine
(that test does not run in CI either).</p>
<h2 id="pre-commit-and-linting">Pre-commit and linting</h2>
<p>Pull requests (PR) to DAPPER are checked with continuous integration (CI),
which runs the tests, and also linting, plus some <code>pre-commit</code> hooks.
To avoid having to wait for the CI server to run all of this,
you'll want to run them on your own computer:</p>
<pre><code class="language-sh">pre-commit install
pre-commit run --all-files
</code></pre>
<p>Now every time you commit, these tests will run on the staged files.
For detailed linting messages, run</p>
<pre><code class="language-sh">flakehell lint
</code></pre>
<h2 id="adding-to-the-examples">Adding to the examples</h2>
<p>Example scripts are very useful, and contributions are very desirable.
As well
as showcasing some feature, new examples should make sure to reproduce some
published literature results.
After making the example, consider converting
the script to the Jupyter notebook format (or vice versa) so that the example
can be run on Colab without users needing to install anything (see
<code>examples/README.md</code>). This should be done using the <code>jupytext</code> plug-in (with
the <code>lightscript</code> format), so that the paired files can be kept in synch.</p>
<h2 id="documentation">Documentation</h2>
<p>The documentation may be generated with <code>pdoc3</code>, e.g.</p>
<pre><code class="language-sh">pdoc --force --html --template-dir docs/templates -o ./docs docs/bib/bib.py docs/dev_guide.py dapper
open docs/index.html # preview
</code></pre>
<p>This is done automatically by a GitHub workflow whenever
the <code>master</code> branch gets updated,
and the generated docs are pushed into the <code>gh-pages</code> branch,
to which the Github <code>Pages</code> settings of points to,
which hosts the website.</p>
<p>In order to add new references,
insert their bibtex into <code>docs/bib/refs.bib</code>,
then run <code>docs/bib/make_bib.py</code>,
which will format and add entries to <code>docs/bib/bib.py</code>.</p>
<p>A live preview of the documentation (that updates whenever you save
the python source file) can be had with</p>
<pre><code class="language-sh">cd docs
pdoc --http : dapper dev_guide.py
</code></pre>
<h2 id="profiling">Profiling</h2>
<ul>
<li>Launch your python script using <code>kernprof -l -v my_script.py</code></li>
<li><em>Functions</em> decorated with <code>profile</code> will be timed, line-by-line.</li>
<li>If your script is launched regularly, then <code>profile</code> will not be
present in the <code>builtins.</code> Instead of deleting your decorations,
you could also define a pass-through fallback.</li>
</ul>
<h2 id="publishing-a-release-on-pypi">Publishing a release on PyPI</h2>
<p><code>cd DAPPER</code></p>
<p>Bump version number in <code>__init__.py</code></p>
<p>Merge <code>dev1</code> into <code>master</code></p>
<pre><code class="language-sh">git checkout master
git merge --no-commit --no-ff dev1
# Fix conflicts, e.g
# git rm &lt;unwanted-file&gt;
git commit
</code></pre>
<p>Make docs (including bib)
Tag</p>
<pre><code class="language-sh">git tag -a v$(python setup.py --version) -m 'My description'
git push origin --tags
</code></pre>
<p>Clean</p>
<pre><code class="language-sh">rm -rf build/ dist *.egg-info .eggs
</code></pre>
<p>Add new files to <code>package_data</code> and <code>packages</code> in <code>setup.py</code></p>
<p>Build</p>
<pre><code class="language-sh">./setup.py sdist bdist_wheel
</code></pre>
<p>Upload to PyPI</p>
<pre><code class="language-sh">twine upload --repository pypi dist/*
</code></pre>
<p>Upload to Test.PyPI</p>
<pre><code class="language-sh">twine upload --repository testpypi dist/*
</code></pre>
<p>where ~/.pypirc contains</p>
<pre><code class="language-ini">[distutils]
index-servers=
                pypi
                testpypi

[pypi]
username: myuser
password: mypass

[testpypi]
repository: https://test.pypi.org/legacy/
username: myuser
password: mypass
</code></pre>
<p>Upload to <code>Test.PyPI</code></p>
<pre><code class="language-sh">git checkout dev1
</code></pre>
<h3 id="test-installation">Test installation</h3>
<p>Install from <code>Test.PyPI</code></p>
<pre><code class="language-sh">pip install --extra-index-url https://test.pypi.org/simple/ dapper
</code></pre>
<p>Install from <code>PyPI</code></p>
<pre><code class="language-sh">pip install dapper
</code></pre>
<ul>
<li>
<p>Install into specific dir (includes all of the dependencies)<br>
<code>pip install dapper -t MyDir</code></p>
</li>
<li>
<p>Install with options<br>
<code>pip install <a title="dapper" href="dapper/index.html">dapper</a>[dev,Qt]</code></p>
</li>
</ul>
<p>Install from local (makes installation accessible from everywhere)</p>
<pre><code class="language-sh">pip install -e .
</code></pre>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/nansencenter/DAPPER/blob/master/docs/dev_guide.py#L1-L226" class="git-link">Browse git</a>
</summary>
<pre><code class="python">&#34;&#34;&#34;# Developer guide

## Conventions

- Ensemble (data) matrices are `np.ndarrays` with shape `N-by-Nx`.
  This shape (orientation) is contrary to the EnKF literature,
  but has the following advantages:
    - Improves speed in row-by-row accessing,
      since that&#39;s `np`&#39;s default orientation.
    - Facilitates broadcasting for, e.g. centring the matrix.
    - Fewer indices: `[n,:]` yields same as `[n]`
    - Beneficial operator precedence without `()`.
      E.g. `dy @ Rinv @ Y.T @ Pw` (where `dy` is a vector)
    - Less transposing for for ensemble space formulae.
    - It&#39;s the standard for data matrices in the broader statistical literature.
- Naming:
    - `E`: ensemble matrix
    - `w`: ensemble weights or coefficients
    - `X`: centred ensemble (&#34;anomalies&#34;)
    - `N`: ensemble size
    - `Nx`: state size
    - `Ny`: observation size
    - *Double letters* means a sequence of something.
      For example:
        - `xx`: Time series of truth; shape `(K+1, Nx)`
        - `yy`: Time series of observations; shape `(KObs+1, Nx)`
        - `EE`: Time series of ensemble matrices
        - `ii`, `jj`: Sequences of indices (integers)
    - `xps`: an `xpList` or `xpDict`,
      where `xp` abbreviates &#34;experiment&#34;.


## Install for development

Make sure you included the dev tools as part of the installation
(detailed in the README):

```sh
pip install -e .[dev]
```

## Run tests

By default, only `doctests` are run when executing `pytest`.
To run the main tests, do this:

```sh
pytest tests
```

You can also append `test_plotting.py` for example,
which is otherwise ignored for being slow.

If the test with the `QG` model in `test_HMM.py` fails
(simply because you have not compiled it) that is fine
(that test does not run in CI either).

## Pre-commit and linting

Pull requests (PR) to DAPPER are checked with continuous integration (CI),
which runs the tests, and also linting, plus some `pre-commit` hooks.
To avoid having to wait for the CI server to run all of this,
you&#39;ll want to run them on your own computer:

```sh
pre-commit install
pre-commit run --all-files
```

Now every time you commit, these tests will run on the staged files.
For detailed linting messages, run

```sh
flakehell lint
```

## Adding to the examples

Example scripts are very useful, and contributions are very desirable.  As well
as showcasing some feature, new examples should make sure to reproduce some
published literature results.  After making the example, consider converting
the script to the Jupyter notebook format (or vice versa) so that the example
can be run on Colab without users needing to install anything (see
`examples/README.md`). This should be done using the `jupytext` plug-in (with
the `lightscript` format), so that the paired files can be kept in synch.

## Documentation

The documentation may be generated with `pdoc3`, e.g.

```sh
pdoc --force --html --template-dir docs/templates -o ./docs \
docs/bib/bib.py docs/dev_guide.py dapper
open docs/index.html # preview
```

This is done automatically by a GitHub workflow whenever
the `master` branch gets updated,
and the generated docs are pushed into the `gh-pages` branch,
to which the Github `Pages` settings of points to,
which hosts the website.

In order to add new references,
insert their bibtex into `docs/bib/refs.bib`,
then run `docs/bib/make_bib.py`,
which will format and add entries to `docs/bib/bib.py`.

A live preview of the documentation (that updates whenever you save
the python source file) can be had with

```sh
cd docs
pdoc --http : dapper dev_guide.py
```

## Profiling

- Launch your python script using `kernprof -l -v my_script.py`
- *Functions* decorated with `profile` will be timed, line-by-line.
- If your script is launched regularly, then `profile` will not be
  present in the `builtins.` Instead of deleting your decorations,
  you could also define a pass-through fallback.

## Publishing a release on PyPI

`cd DAPPER`

Bump version number in `__init__.py`

Merge `dev1` into `master`

```sh
git checkout master
git merge --no-commit --no-ff dev1
# Fix conflicts, e.g
# git rm &lt;unwanted-file&gt;
git commit
```

Make docs (including bib)
Tag

```sh
git tag -a v$(python setup.py --version) -m &#39;My description&#39;
git push origin --tags
```

Clean

```sh
rm -rf build/ dist *.egg-info .eggs
```

Add new files to `package_data` and `packages` in `setup.py`

Build

```sh
./setup.py sdist bdist_wheel
```

Upload to PyPI

```sh
twine upload --repository pypi dist/*
```


Upload to Test.PyPI

```sh
twine upload --repository testpypi dist/*
```

where ~/.pypirc contains

```ini
[distutils]
index-servers=
                pypi
                testpypi

[pypi]
username: myuser
password: mypass

[testpypi]
repository: https://test.pypi.org/legacy/
username: myuser
password: mypass
```

Upload to `Test.PyPI`

```sh
git checkout dev1
```

### Test installation


Install from `Test.PyPI`

```sh
pip install --extra-index-url https://test.pypi.org/simple/ dapper
```

Install from `PyPI`

```sh
pip install dapper
```

- Install into specific dir (includes all of the dependencies)  
  `pip install dapper -t MyDir`

- Install with options  
  `pip install dapper[dev,Qt]`

Install from local (makes installation accessible from everywhere)

```sh
pip install -e .
```
&#34;&#34;&#34;
# vim: ft=markdown</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="DAPPER" href="https://nansencenter.github.io/DAPPER">
<img src="https://raw.githubusercontent.com/nansencenter/DAPPER/master/docs/imgs/logo_wtxt.png" alt="">
<!-- can add style="width:200px;" to img -->
</a>
</header>
<div class="gcse-search" style="height: 70px"
data-as_oq="inurl:github.com/nansencenter/DAPPER site:nansencenter.github.io/DAPPER"
data-gaCategoryParameter="dev_guide">
</div>
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#developer-guide">Developer guide</a><ul>
<li><a href="#conventions">Conventions</a></li>
<li><a href="#install-for-development">Install for development</a></li>
<li><a href="#run-tests">Run tests</a></li>
<li><a href="#pre-commit-and-linting">Pre-commit and linting</a></li>
<li><a href="#adding-to-the-examples">Adding to the examples</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#profiling">Profiling</a></li>
<li><a href="#publishing-a-release-on-pypi">Publishing a release on PyPI</a><ul>
<li><a href="#test-installation">Test installation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<ul id="index">
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>